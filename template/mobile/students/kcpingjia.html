<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="format-detection" content="telephone=no">
<meta name="HandheldFriendly" content="true" />
<link rel="stylesheet" href="{OSSURL}public/mobile/css/resetnew.css">
{php echo register_jssdks();}
{php include $this->template('shoucecss');}
<style type="text/css">
	.selectList {position: fixed;left: 0;right: 0;top: 0;bottom: 0;-webkit-box-sizing: border-box;box-sizing: border-box;background-color: rgba(0,0,0,.53);
text-align: center;z-index: 30;font-size: 20px;color: #fe6700;}
.selectList .single {position: absolute;left: 6%;right: 6%;top: 5%;padding: 0 20px;background-color: #fff;padding-bottom: 33px;padding-top: 10px;}
.selectList ul {width: 100%;height: auto;overflow: auto;}
.selectList ul li {height: 50px;line-height: 50px;border-bottom: 1px solid #e9e9e9;padding: 0 10px;}
.selectList ul li span.le {height: 50px;line-height: 50px;float: left;font-size: 16px;}
.selectList ul li span.ri {float: right;height: 50px;line-height: 50px;font-size: 16px;}

.header { width: 100%; height: 50px; line-height: 50px; position: fixed; z-index: 1000; top: 0; left: 0; box-shadow: 0 0 2px 0px rgba(0,0,0,0.3),0 0 6px 2px rgba(0,0,0,0.15); }
.header .l { width: 50px; height: 50px; line-height: 50px; color: white; position: absolute; left: 0; top: 0; } 
.header .m { width: 100%; height: 50px; line-height: 50px; text-align: center; color: white; font-size: 18px; } 
.header .r { width: 50px; height: 50px; line-height: 50px; position: absolute; right: 0; top: 0; } 
.mainColor { background: {$school['headcolor']} !important; } 
.header .l a { font-size: 18px; color: white; display: block; width: 100%; height: 100%; text-align: center; }
.head_til img{width: 25px;height: 25px;display: inline-block;float: left;border-radius: 40px;}
body {background-color: #E7FAFF;}
.bottom_control_row .prev_btn1 {margin: 15px 5px 15px 35px;float: left;width: 100px;background-color: #e5457f;border-radius: 3px;line-height: 35px;height: 35px;text-align: center;}
.bottom_control_row .prev_btn1 a, .bottom_control_row .next_btn a {color: #fff;}
.bottom_control_row .prev_btn2 {margin: 15px 5px 15px 35px;float: left;width: 100px;background-color: #e5457f;border-radius: 3px;line-height: 35px;height: 35px;text-align: center;}
.bottom_control_row .prev_btn2 a, .bottom_control_row .next_btn a {color: #fff;}
</style>
<script type="text/javascript" src="{MODULE_URL}public/mobile/js/jquery-1.11.3.min.js?v=4.8"></script>
{php include $this->template('port');}
<title>{$school['title']}</title>
</head>
<body>
<div class="header mainColor" id="titlebar">
	<div class="l">
		<a class="backOff" style="background:url({OSSURL}public/mobile/img/ic_arrow_left_48px_white.svg) no-repeat;background-size: 55% 55%;background-position: 50%;" href="{php echo $this->createMobileUrl('myclass', array('schoolid' => $schoolid,'weid' => $weid), true)}"></a>
	</div>
	<div class="m">
		<a><span style="font-size: 18px">评价课程</span></a>
	</div>
	
	
</div>
<div class="All">
<div id="titlebar_bg" class="top_height_blank"></div>
<div class="manual_main1">
    <div class="manual_visible_box">
        <div class="manual_main_box2">
        	<div class="head_til" style="border-bottom: unset;">
				<div id="wrap" class="count_inf" style="min-width:unset;">
			        <dl id="main">
			            <dt class="count_tit" style="color:#4896c5;text-align: unset;">{$kcinfo['name']}</dt>
			            <dd class="count_inf">
				            {if !empty($checktid)}
				            <div class="teacher" style="padding-bottom: 10px;">
			                    <div style=" background-image:url({if !empty($teacher['thumb'])}{php echo tomedia($teacher['thumb']);}{else}{php echo tomedia($school['tpic']);}{/if})"></div>
			                    <p>{$teacher['tname']}</p>
			                </div>
			                {else}
			                <div class="teacher" style="padding-bottom: 10px;">
			                    <div style=" background-image:url({if !empty($tname_array[$kcinfo['maintid']]['thumb'])}{php echo tomedia($tname_array[$kcinfo['maintid']]['thumb']);}{else}{php echo tomedia($school['tpic']);}{/if})"></div>
			                    <p>{$tname_array[$kcinfo['maintid']]['tname']}</p>
			                </div>
			                {/if}
			                <ul>
			                    <li>
				                   	<label>日期：</label>
			                    	{php echo date('y/m/d',$kcinfo['start'])}-{php echo date('y/m/d',$kcinfo['end'])}
			                    </li>
			                    <li>
				                    <label>科目：</label>
				                    
				                    {if !empty($kcinfo['xq_id'])}
				                    {$category[$kcinfo['bj_id']]['sname']}/{$category[$kcinfo['km_id']]['sname']}
				                    {else}{$category[$kcinfo['km_id']]['sname']}
				                    {/if}
			                    </li>
			                    <li>
				                    <label>教室：</label>
				                    {$category[$kcinfo['adrr']]['sname']}
				                </li>
			                    <li>
				                    <label>主讲教师：</label>
				                    
				                    {$tname_array[$kcinfo['maintid']]['tname']}
				                </li>
			                </ul>            
			                <div style="clear:both"></div>
			            </dd> 	
			        </dl>
				</div>
			</div>
			{if empty($check)}
			<ul class="manual_baby_situation_ul">
				<span style="font-size: 15px;">评分:&nbsp;</span>
				{loop $tname_array $row}
				<div>
					<span id="tname_{$row['id']}" style="font-size: 15px;width:65px;display:inline-block;text-align: center;">{$row['tname']}:</span>
					<a href="javascript:hs_click(1,{$row['id']})"><img style="width: 17px;padding-bottom: 6px;" src="{MODULE_URL}public/mobile/img/star_pingjia_gray.png" id="star1_{$row['id']}"/></a>
					<a href="javascript:hs_click(2,{$row['id']})"><img style="width: 17px;padding-bottom: 6px;" src="{MODULE_URL}public/mobile/img/star_pingjia_gray.png" id="star2_{$row['id']}"/></a>
					<a href="javascript:hs_click(3,{$row['id']})"><img style="width: 17px;padding-bottom: 6px;" src="{MODULE_URL}public/mobile/img/star_pingjia_gray.png" id="star3_{$row['id']}"/></a>
					<a href="javascript:hs_click(4,{$row['id']})"><img style="width: 17px;padding-bottom: 6px;" src="{MODULE_URL}public/mobile/img/star_pingjia_gray.png" id="star4_{$row['id']}"/></a>
					<a href="javascript:hs_click(5,{$row['id']})"><img style="width: 17px;padding-bottom: 6px;" src="{MODULE_URL}public/mobile/img/star_pingjia_gray.png" id="star5_{$row['id']}"/></a>
					<span id="message_{$row['id']}" >&nbsp;未评分</span>
				</div>
				{/loop}
			</ul>
			<div class="parent_evaluation_box">
				<textarea placeholder="说一说你的评价,100字以内" id="eval_text"  maxlength="100" onkeydown="if(this.value.length>=40) {event.returnValue=false}" ></textarea>
				<div class="clear1"></div>
			</div>
			{elseif !empty($check)}
			<ul class="manual_baby_situation_ul">
				<span style="font-size: 15px;color:#6363d4;font-weight:bold">教师评分:&nbsp;</span>
				{loop $tname_array $row}
				<div>
					<span id="tname_{$row['id']}" style="font-size: 15px;width:65px;display:inline-block;text-align: center;">{$row['tname']}:</span>
					<a ><img style="width: 17px;padding-bottom: 6px;" 
					{if $row['star'] >0}
					src="{MODULE_URL}public/mobile/img/star_pingjia_red.png"
					{elseif $row['star'] ==0 }
					src="{MODULE_URL}public/mobile/img/star_pingjia_gray.png"
					{/if}
					/></a>
					<a ><img style="width: 17px;padding-bottom: 6px;" 
					{if $row['star'] >1}
					src="{MODULE_URL}public/mobile/img/star_pingjia_red.png"
					{elseif $row['star'] <=1 }
					src="{MODULE_URL}public/mobile/img/star_pingjia_gray.png"
					{/if}
					/></a>
					<a ><img style="width: 17px;padding-bottom: 6px;" 
					{if $row['star'] >2}
					src="{MODULE_URL}public/mobile/img/star_pingjia_red.png"
					{elseif $row['star'] <=2 }
					src="{MODULE_URL}public/mobile/img/star_pingjia_gray.png"
					{/if}
					/></a>
					<a ><img style="width: 17px;padding-bottom: 6px;" 
					{if $row['star'] >3}
					src="{MODULE_URL}public/mobile/img/star_pingjia_red.png"
					{elseif $row['star'] <=3 }
					src="{MODULE_URL}public/mobile/img/star_pingjia_gray.png"
					{/if}
					/></a>
					<a ><img style="width: 17px;padding-bottom: 6px;" 
					{if $row['star'] >4}
					src="{MODULE_URL}public/mobile/img/star_pingjia_red.png"
					{elseif $row['star'] <=4 }
					src="{MODULE_URL}public/mobile/img/star_pingjia_gray.png"
					{/if}
					/></a>
					
					<span>
					{if $row['star'] ==0}
					未评分
					{elseif $row['star'] ==1}
					1分-很差
					{elseif $row['star'] ==2}
					2分-比较差
					{elseif $row['star'] ==3}
					3分-一般
					{elseif $row['star'] ==4}
					4分-比较好
					{elseif $row['star'] ==5}
					5分-很好
					{/if}
					</span>
				</div>
				{/loop}
				</ul>
				<div class="parent_evaluation_box">
					<span style="font-size: 15px;color:#6363d4;font-weight:bold">课程评价:</span></br>
					<span>{$check['content']}</span>
				<!--<textarea placeholder="{$check['content']}"  maxlength="100"  ></textarea>-->
				<div class="clear1"></div>
			</div>
			{/if}
            <div class="blank"></div>
            <div class="small_blank"></div>
        </div>
    </div>
	{if empty($check)}
    <div class="bottom_control_row">
        <div class="prev_btn" type="prev"><a href="javascript:tijiao();">提交</a></div>
    </div>	
    {/if}

<div class="clear"></div>
</div>
<div class="selectList" id="selectList" style="z-index:100000;display:{if empty($userid)} block{else}none{/if};">
		<div class="single" style="z-index:100000;border-radius: 5%;">
			<ul>
				<span style="color:#444;">切换学生</span>
			{loop $alluser $row}
				<li onclick="isSelect1({$row['id']});"><span class="le">{if $row['type'] == 1}{$row['bjname']} {else}老师{/if}</span><span class="ri">{if $row['type'] == 1}{$row['s_name']}{else}{$row['tname']}{/if}</span></li>
			{/loop}	
			</ul>
		</div>
	</div>	
</body>
</html>
<script type="text/javascript">
	var check = new Array();
function hs_click(param,ord){
	check[ord] = param;//记录当前打分
	out(ord);//设置星星数
}

function out(ord){
	if(check[ord] == 1){//打分是1，设置第一颗星星亮，其他星星暗，其他情况以此类推
		$("#star1_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star2_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#star3_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#star4_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#star5_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#message_"+ord).html("1分-很差");
	}else if(check[ord] == 2){
		$("#star1_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star2_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star3_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#star4_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#star5_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#message_"+ord).html("2分-比较差");
	}else if(check[ord] == 3){
		$("#star1_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star2_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star3_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star4_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#star5_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#message_"+ord).html("3分-一般");
	}else if(check[ord] == 4){
		$("#star1_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star2_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star3_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star4_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star5_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#message_"+ord).html("4分-比较好");
	}else if(check[ord] == 5){
		$("#star1_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star2_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star3_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star4_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#star5_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_red.png");
		$("#message_"+ord).html("5分-很好");
	}else if(check[ord] == 0){
		$("#star1_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#star2_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#star3_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#star4_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#star5_"+ord).attr("src","{MODULE_URL}public/mobile/img/star_pingjia_gray.png");
		$("#message_"+ord).html("0分");
	}
}


function tijiao(){
	var pingjia = $("#eval_text").val();
	
	if(pingjia == '' || pingjia == null){
		jTips("请输入评价内容");
		return;
	}
	$.ajax({
		url: "{php echo $this->createMobileUrl('kcajax', array('schoolid' => $schoolid,'op' => 'kcpingjia'), true)}",
		data: { pingjia: pingjia, check: check, sid: "{$it['sid']}", userid: "{$it['id']}", weid: "{$weid}",kcid:"{$kcid}"},
		type: "post",
		dataType:"json",
		success: function (data) {
			if (data.status == 1) {
				jTips(data.msg);
				location.reload();
			};		
		}
	});
}
	$(".choice_baby").on("click", function() {
		
		$("#selectList").show();
	});
//	function isSelect1(userid){
//	location.href = "{php echo $this->createMobileUrl('gkkpingjia')}"+ '&userid=' + userid + '&schoolid=' + {$schoolid} + '&op=edite&gkkid=' + {$gkkid}  ;
//	location.href = reload();
//}
setTimeout(function() {
	if(window.__wxjs_environment === 'miniprogram'){
		$("#titlebar").hide();
		$("#titlebar_bg").hide();
		document.title="评价课程";
	}
}, 100);

</script>
<script>
$(".manual_baby_situation_ul").on("click", ".li_block_2 div", function () {
	$(this).addClass("on").siblings("div").removeClass("on");
})

//$(".prev_btn").on("click", function () {
//	var comment = iphone_emoji_filter($.trim($("#eval_text").val()));
//	var performance = "";
//	$(".manual_baby_situation_ul li").each(function () {
//		performance += $(this).find(".li_block_2").attr("record_uid") + "_" + $(this).find(".li_block_2 .on").attr("icon_index")+",";
//	});
//	var type = $(this).attr("type");
//	$.ajax({
//		url: "{php echo $this->createMobileUrl('gkkpingjia', array('schoolid' => $schoolid,'gkkid'=>$gkkid,'op' => 'savedata'), true)}",
//		data: { comment: comment, performance: performance, sid: "{$it['sid']}", scid: "{$scid}", setid: "{$setid}" , tid: "{$it['tid']}", userid: "{$userid}", weid: "{$weid}"},
//		type: "post",
//		dataType:"json",
//		success: function (data) {
//			jTips(data.info, function () {
//				if (data.status == 1) {
//					window.location.href = "{php echo $this->createMobileUrl('gkkpjshare', array('schoolid' => $schoolid,'op' => 'check','userid' => $userid,'gkkid'=>$gkkid,'fenxiang'=>'fenxiang'), true)}";
//				}
//			});		
//		}
//	});
//});
$(".prev_btn1").on("click", function () {
	var comment = iphone_emoji_filter($.trim($("#eval_text").val()));
	var performance = "";
	$(".manual_baby_situation_ul li").each(function () {
		performance += $(this).find(".li_block_2").attr("record_uid") + "_" + $(this).find(".li_block_2 .on").attr("icon_index")+",";
	});
	var type = $(this).attr("type");
	$.ajax({
		url: "{php echo $this->createMobileUrl('scforxs', array('schoolid' => $schoolid,'op' => 'updata'), true)}",
		data: { comment: comment, performance: performance, sid: "{$it['sid']}", scid: "{$scid}", setid: "{$setid}" , tid: "{$it['tid']}", userid: "{$it['id']}", weid: "{$weid}"},
		type: "post",
		dataType:"json",
		success: function (data) {
			jTips(data.info, function () {
				if (data.status == 1) {
					window.location.href = "{php echo $this->createMobileUrl('sclistforxs', array('schoolid' => $schoolid,'userid' => $it['id']), true)}";
				}
			});		
		}
	});
});
</script>
<script>  

wx.ready(function () {
	sharedata = {
		title: "{$sharetitle}",
		desc: "{$sharedesc}",
		link: "{$links}",
		imgUrl: "{$shareimgUrl}",
		success: function(){
			
		},
		cancel: function(){

		}
	};	
	wx.onMenuShareAppMessage(sharedata);
	wx.onMenuShareTimeline(sharedata);
});

$(function() {

	WeixinJSShowShareMenu();

    WeixinJSShowProfileMenuAndShare();
		
});

function WeixinJSShowShareMenu(){
	if (typeof wx != "undefined"){
		wx.ready(function () {
			wx.showMenuItems({
			    menuList: ['menuItem:share:appMessage','menuItem:share:timeline'] // 要显示的菜单项，所有menu项见附录3
			});
		});
	}
}	


function WeixinJSShowProfileMenuAndShare(){
	
	if (typeof wx != "undefined"){
		wx.ready(function () {
			wx.showMenuItems({
			    menuList: ['menuItem:share:appMessage','menuItem:share:timeline','menuItem:profile','menuItem:addContact','menuItem:favorite'] // 要显示的菜单项，所有menu项见附录3
			});
		});
	}
}
var WeixinApi = (function () {
	
	return {
        ready           :wxJsBridgeReady,
        imagePreview    :imagePreview
    }; 
	
    "use strict";

    /**
     * 调起微信Native的图片播放组件。
     * 这里必须对参数进行强检测，如果参数不合法，直接会导致微信客户端crash
     *
     * @param {String} curSrc 当前播放的图片地址
     * @param {Array} srcList 图片地址列表
     */
    function imagePreview(curSrc,srcList) {
        if(!curSrc || !srcList || srcList.length == 0) {
            return;
        }
        WeixinJSBridge.invoke('imagePreview', {
            'current' : curSrc,
            'urls' : srcList
        });
    }
	
    /**
     * 当页面加载完毕后执行，使用方法：
     * WeixinApi.ready(function(Api){
     *     // 从这里只用Api即是WeixinApi
     * });
     * @param readyCallback
     */
    function wxJsBridgeReady(readyCallback) {
        if (readyCallback && typeof readyCallback == 'function') {
            var Api = this;
            var wxReadyFunc = function () {
                readyCallback(Api);
            };
            if (typeof window.WeixinJSBridge == "undefined"){
                if (document.addEventListener) {
                    document.addEventListener('WeixinJSBridgeReady', wxReadyFunc, false);
                } else if (document.attachEvent) {
                    document.attachEvent('WeixinJSBridgeReady', wxReadyFunc);
                    document.attachEvent('onWeixinJSBridgeReady', wxReadyFunc);
                }
            }else{
                wxReadyFunc();
            }
        }
    }

    return {
        version         :"2.5",
        ready           :wxJsBridgeReady,
        imagePreview    :imagePreview
    };
})();
<?php
if (!empty($_W['setting']['remote']['type'])) { 
	$urls = $_W['SITEROOT'].$_W['config']['upload']['attachdir'].'/'; 
	} else {
	$urls = $_W['attachurl'];  
	}
?>
var ALI_URL = "{$urls}";
var ALI_URL_VIEDO = "{$urls}";
function wxImageShow(node){
	var srcList = new Array();
	var watermark='';
	var imgs = $(node).closest('.parent').find("img");	
	var curSrc = $(node).find("img")[0]['src'].split("@");
	//alert(curSrc);
	var curImgIndex=0;
	for(i=0;i<imgs.length;i++){
		var imgsrc = imgs[i]['src'].split("@");
		if(imgsrc.length>1){
			if(imgsrc[1].split("watermark").length>1){
				srcList.push(imgsrc[0].replace(ALI_URL,ALI_URL_VIEDO)+'@watermark'+imgsrc[1].split("watermark")[1]);
				watermark = '@watermark'+imgsrc[1].split("watermark")[1];
			}else{
				srcList.push(imgsrc[0].replace(ALI_URL,ALI_URL_VIEDO));
			}
		}else{
			srcList.push(imgsrc[0]);
		}
		if(curSrc[0]==imgsrc[0]){
			curImgIndex=i;
		}
	}
	curSrc[0]=curSrc[0]+watermark;

	WeixinApi.imagePreview(curSrc[0].replace(ALI_URL,ALI_URL_VIEDO), srcList);
}
</script>

